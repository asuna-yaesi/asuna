<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Ç∞„ÉÉ„Ç∫Âõ≥Èëë</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/goodslist.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>

<body>
    <div class="wrapper">
        <header class="header">
            <h1>„Ç∞„ÉÉ„Ç∫‰∏ÄË¶ß</h1>
            <div class="icon">
                <i class="fas fa-cog"></i>
                <div class="menu">
                    <a href="#" id="reset">„Éª„É™„Çª„ÉÉ„Éà</a>
                </div>
            </div>
        </header>
    
        <div class="container">
            <div class="search-container">
                <form method="get" action="/goodslist" style="display: flex; align-items: center;">
                    <input 
                        type="text" 
                        id="searchInput" 
                        name="search" 
                        placeholder="„Ç≠„Éº„ÉØ„Éº„Éâ„ÅßÊ§úÁ¥¢" 
                        value="{{ search_query }}">
                    
                    <button type="submit" id="searchButton">
                        üîç
                    </button>
    
                    {% if search_query %}
                    <button type="button" id="resetButton" onclick="resetSearch()">
                        √ó
                    </button>
                    {% endif %}
                </form>
            </div>
    
            <div class="status-button-container">
                <button id="changeStatusButton" class="change-button">
                    <span class="material-icons" style="vertical-align: middle;">autorenew</span>
                    <span id="statusText">ÂÖ®„Å¶</span>
                </button>
            </div>
    
            <div class="button-group">
                <button id="goodsListButton" class="scroll-to-top" onclick="changePage(1)">„Ç∞„ÉÉ„Ç∫‰∏ÄË¶ß</button>
                <button id="wishlistButton" class="scroll-to-top" onclick="redirectToGoods2()">Ê¨≤„Åó„ÅÑ„ÇÇ„ÅÆ</button>
            </div>
        </div>
    
        <div id="imageContainer">
            {% for item in image_links %}
                <div class="image-container">
                    <a href="{{ item.link }}"><img src="{{ item.image_url }}" alt="Image"></a>
                    <img src="{{ url_for('static', filename='icons/heart-regular.svg') }}" class="heart-icon" alt="Heart Icon">
                    <img src="{{ url_for('static', filename='icons/check-circle-regular.svg') }}" class="check-icon" alt="Check Icon">
                    <p class="hidden-text">{{ item.other_text }}</p> <!-- ÂïÜÂìÅ„ÅÆ„Åù„ÅÆ‰ªñ„ÅÆ„ÉÜ„Ç≠„Çπ„Éà -->
                </div>
            {% endfor %}
        </div>
    
        <div id="overlay" class="overlay"></div>
    
        <div class="pagination-container">
            <div class="pagination" id="pagination">
                {% if current_page > 1 %}
                    <a href="?page={{ current_page - 1 }}&search={{ search_query }}" class="page-link">Ôºú </a>
                {% endif %}
    
                {% if current_page > 3 %}
                    <a href="?page=1&search={{ search_query }}" class="page-link">1</a>
                    {% if current_page > 4 %}
                        <span class="ellipsis">...</span>
                    {% endif %}
                {% endif %}
    
                {% for i in range(current_page - 2, current_page + 3) %}
                    {% if i > 0 and i <= total_pages %}
                        {% if i == current_page %}
                            <span class="page-link active">{{ i }}</span>
                        {% else %}
                            <a href="?page={{ i }}&search={{ search_query }}" class="page-link">{{ i }}</a>
                        {% endif %}
                    {% endif %}
                {% endfor %}
    
                {% if current_page < total_pages - 2 %}
                    {% if current_page < total_pages - 3 %}
                        <span class="ellipsis">...</span>
                    {% endif %}
                    <a href="?page={{ total_pages }}&search={{ search_query }}" class="page-link">{{ total_pages }}</a>
                {% endif %}
    
                {% if current_page < total_pages %}
                    <a href="?page={{ current_page + 1 }}&search={{ search_query }}" class="page-link"> Ôºû</a>
                {% endif %}
            </div>
        </div>
    </div> <!-- wrapper end -->

    <footer class="footer">
        <div class="footer-top">
            <div class="footer-cell">
                <a href="{{ url_for('home') }}">„Éõ„Éº„É†</a>
            </div>
            <div class="footer-cell">‰ΩøÁî®ÊñπÊ≥ï</div>
        </div>
        <div class="footer-bottom">
            <div class="footer-cell">ÈÄ£Áµ°ÂÖà</div>
            <div class="footer-cell">ÂÖçË≤¨‰∫ãÈ†Ö</div>
        </div>
        <div class="footer-copyright">
            Copyright ¬© 2024 „Ç∞„ÉÉ„Ç∫Âõ≥Èëë. All rights reserved.
        </div>
    </footer>

    <script>

        function resetSearch() {
            document.getElementById('searchInput').value = '';
            const form = document.querySelector('form');
            form.submit();
        }



        // „Ç¢„Ç§„Ç≥„É≥„ÇØ„É™„ÉÉ„ÇØ„Åß„É°„Éã„É•„Éº„ÅÆË°®Á§∫/ÈùûË°®Á§∫„ÇíÂàá„ÇäÊõø„Åà„Çã
        document.querySelector('.icon').addEventListener('click', function () {
            const menu = document.querySelector('.menu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        });

        // „É™„Çª„ÉÉ„Éà„Éú„Çø„É≥„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà„ÇíËøΩÂä†
        document.getElementById('reset').addEventListener('click', function (e) {
            e.preventDefault();


            if (confirm("Êú¨ÂΩì„Å´Ë®òÈå≤„Åï„Çå„ÅüÁä∂ÊÖã„Çí„Åô„Åπ„Å¶„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü")) {
                // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„ÇíÂÖ®ÂâäÈô§
                localStorage.clear();
                alert("„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü„ÄÇ");

                location.reload();
            }
        });

        // „É°„Éã„É•„ÉºÂ§ñ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Åü„Çâ„É°„Éã„É•„Éº„ÇíÈùûË°®Á§∫„Å´„Åô„Çã
        document.addEventListener('click', function (e) {
            const menu = document.querySelector('.menu');
            const icon = document.querySelector('.icon');
            if (!icon.contains(e.target)) {
                menu.style.display = 'none';
            }
        });


        function changePage(pageNumber) {
            // ÁèæÂú®„ÅÆÊ§úÁ¥¢„Ç≠„Éº„ÉØ„Éº„Éâ„Çí‰øùÊåÅ„Åó„Å¶„É™„ÉÄ„Ç§„É¨„ÇØ„Éà
            const searchQuery = document.getElementById('searchInput')?.value || '';
            window.location.href = `?page=${pageNumber}&search=${encodeURIComponent(searchQuery)}`;
        }


        function redirectToGoods2() {
            window.location.href = "{{ url_for('goods2') }}";
        }

        document.addEventListener("DOMContentLoaded", function () {
            let clickedImageUrls = JSON.parse(localStorage.getItem("clickedImageUrls")) || [];
            let checkedImageUrls = JSON.parse(localStorage.getItem("checkedImageUrls")) || [];
            const imageContainers = document.querySelectorAll(".image-container");
            const overlay = document.getElementById("overlay"); // „Ç™„Éº„Éê„Éº„É¨„Ç§Ë¶ÅÁ¥†
            const statuses = ["ÂÖ®„Å¶", "Êú™ÂÖ•Êâã", "ÂÖ•ÊâãÊ∏à"]; // „Çπ„ÉÜ„Éº„Çø„ÇπÈÖçÂàó
            let currentStatusIndex = 0; // ÂàùÊúü„Çπ„ÉÜ„Éº„Çø„Çπ
        
            imageContainers.forEach((container) => {
                const imgElement = container.querySelector("img");
                const heartIcon = container.querySelector(".heart-icon");
                const checkIcon = container.querySelector(".check-icon");
                const imageUrl = imgElement.src;

                // SVG„Éï„Ç°„Ç§„É´„ÅÆ„Éë„Çπ
                const heartFar = "{{ url_for('static', filename='icons/heart-regular.svg') }}";
                const heartFas = "{{ url_for('static', filename='icons/heart-solid.svg') }}";
                const checkFar = "{{ url_for('static', filename='icons/check-circle-regular.svg') }}";
                const checkFas = "{{ url_for('static', filename='icons/check-circle-solid.svg') }}";
        
                // Áä∂ÊÖã„ÇíÂæ©ÂÖÉ
                if (clickedImageUrls.some((item) => item.image_url === imageUrl)) {
                    heartIcon.src = heartFas;
                } else {
                    heartIcon.src = heartFar;
                }
        
                if (checkedImageUrls.some((item) => item.image_url === imageUrl)) {
                    checkIcon.src = checkFas;
                } else {
                    checkIcon.src = checkFar;
                }
        
                // „Éè„Éº„Éà„Ç¢„Ç§„Ç≥„É≥„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
                heartIcon.addEventListener("click", function () {
                            
                    const matchingItem = {
                        image_url: imageUrl,
                        link: container.querySelector("a").href, // „É™„É≥„ÇØÂÖà„ÇíÂèñÂæó
                        other_text: container.querySelector(".hidden-text").textContent.trim()
                    };


                    if (heartIcon.src.endsWith("heart-regular.svg")) {
                        heartIcon.src = heartFas;
                        if (!clickedImageUrls.some((item) => item.image_url === imageUrl)) {
                            clickedImageUrls.push(matchingItem);
                        }
                    } else {
                        heartIcon.src = heartFar;
                        clickedImageUrls = clickedImageUrls.filter((item) => item.image_url !== imageUrl);
                    }
        
                    localStorage.setItem("clickedImageUrls", JSON.stringify(clickedImageUrls));
                });
        
                // „ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç§„Ç≥„É≥„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
                checkIcon.addEventListener("click", function () {
              
                    const matchingItem = {
                        image_url: imageUrl,
                        link: container.querySelector("a").href, // „É™„É≥„ÇØÂÖà„ÇíÂèñÂæó
                        other_text: container.querySelector(".hidden-text").textContent.trim()
                    };


                    if (checkIcon.src.endsWith("check-circle-regular.svg")) {
                        checkIcon.src = checkFas;
                        if (!checkedImageUrls.some((item) => item.image_url === imageUrl)) {
                            checkedImageUrls.push(matchingItem);
                        }
                    } else {
                        checkIcon.src = checkFar;
                        checkedImageUrls = checkedImageUrls.filter((item) => item.image_url !== imageUrl);
                    }

                            
                    localStorage.setItem("checkedImageUrls", JSON.stringify(checkedImageUrls));

                    updateOverlay();
                });
            });

            // „Çπ„ÉÜ„Éº„Çø„ÇπÂ§âÊõ¥„Éú„Çø„É≥„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
            document.getElementById("changeStatusButton").addEventListener("click", function () {
                currentStatusIndex = (currentStatusIndex + 1) % statuses.length;
                const currentStatus = statuses[currentStatusIndex];
                document.getElementById("statusText").textContent = currentStatus;

                updateOverlay();
            });

            // „Çπ„ÉÜ„Éº„Çø„Çπ„Å´Âøú„Åò„Åü„Ç™„Éº„Éê„Éº„É¨„Ç§„ÇíÊõ¥Êñ∞
            function updateOverlay() {
                const currentStatus = statuses[currentStatusIndex];


                imageContainers.forEach((container) => {
                    const checkIcon = container.querySelector(".check-icon");
                    const isChecked = checkIcon.src.endsWith("check-circle-solid.svg");
                    const overlayElement = container.querySelector(".overlay");

                    if (currentStatus === "Êú™ÂÖ•Êâã" && isChecked) {
                        container.classList.add("with-overlay");
                    } else if (currentStatus === "ÂÖ•ÊâãÊ∏à" && !isChecked) {
                        container.classList.add("with-overlay");
                    } else {
                        container.classList.remove("with-overlay");
                    }
                });
            }

            // ÂàùÊúü„Ç™„Éº„Éê„Éº„É¨„Ç§„ÅÆË®≠ÂÆö
            updateOverlay();
        });
    </script>

</body>
</html>
